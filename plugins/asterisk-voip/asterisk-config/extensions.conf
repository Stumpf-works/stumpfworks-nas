;
; Dialplan Configuration for StumpfWorks Asterisk
;

[general]
static = yes
writeprotect = no
clearglobalvars = no

;
; Global Variables
;
[globals]
RECORDING_DIR = /var/spool/asterisk/monitor
VOICEMAIL_DIR = /var/spool/asterisk/voicemail

;
; Internal Context - For internal calls between extensions
;
[internal]
; Extension to Extension calling
exten => _1XXX,1,NoOp(Internal call from ${CALLERID(num)} to ${EXTEN})
same => n,Dial(SIP/${EXTEN},30,tT)
same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
same => n(unavail),VoiceMail(${EXTEN}@default,u)
same => n,Hangup()
same => n(busy),VoiceMail(${EXTEN}@default,b)
same => n,Hangup()

; Voicemail access
exten => *97,1,NoOp(Voicemail access for ${CALLERID(num)})
same => n,VoiceMailMain(${CALLERID(num)}@default)
same => n,Hangup()

; Echo test
exten => *43,1,NoOp(Echo Test)
same => n,Answer()
same => n,Playback(demo-echotest)
same => n,Echo()
same => n,Playback(demo-echodone)
same => n,Hangup()

; Conference room example
exten => 8000,1,NoOp(Conference Room)
same => n,Answer()
same => n,ConfBridge(8000)
same => n,Hangup()

; Call recording toggle
exten => *1,1,NoOp(Toggle Call Recording)
same => n,Set(RECORDING_STATUS=${IF($[${RECORDING_STATUS}=1]?0:1)})
same => n,GotoIf($[${RECORDING_STATUS}=1]?start:stop)
same => n(start),MixMonitor(${RECORDING_DIR}/${UNIQUEID}.wav)
same => n,Playback(beep)
same => n,Hangup()
same => n(stop),StopMixMonitor()
same => n,Playback(beep)
same => n,Hangup()

;
; External Context - For outgoing calls
;
[external]
; Example: Dial out via trunk
; exten => _0.,1,NoOp(Outgoing call to ${EXTEN:1})
; same => n,Dial(SIP/${EXTEN:1}@provider-trunk,60)
; same => n,Hangup()

;
; Incoming Context - For incoming calls from trunk
;
[from-trunk]
; Example: Route incoming calls
; exten => s,1,NoOp(Incoming call from ${CALLERID(num)})
; same => n,Answer()
; same => n,Dial(SIP/1000,30)
; same => n,VoiceMail(1000@default,u)
; same => n,Hangup()

;
; IVR Example
;
[ivr-main]
exten => s,1,NoOp(Main IVR)
same => n,Answer()
same => n,Background(welcome)
same => n,WaitExten(5)

exten => 1,1,NoOp(Pressed 1 - Sales)
same => n,Dial(SIP/1001,30)
same => n,VoiceMail(1001@default,u)
same => n,Hangup()

exten => 2,1,NoOp(Pressed 2 - Support)
same => n,Dial(SIP/1002,30)
same => n,VoiceMail(1002@default,u)
same => n,Hangup()

exten => 0,1,NoOp(Pressed 0 - Operator)
same => n,Dial(SIP/1000,30)
same => n,VoiceMail(1000@default,u)
same => n,Hangup()

exten => i,1,NoOp(Invalid entry)
same => n,Playback(invalid)
same => n,Goto(s,1)

exten => t,1,NoOp(Timeout)
same => n,Playback(vm-goodbye)
same => n,Hangup()

;
; Default Context - Catchall
;
[default]
exten => _X.,1,NoOp(Unhandled extension ${EXTEN})
same => n,Playback(ss-noservice)
same => n,Hangup()
