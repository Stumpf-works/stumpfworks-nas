# ğŸ¯ StumpfWorks NAS Apps Repository - Session Context

You are working in the **StumpfWorks NAS Apps Repository** - the official plugin registry and distribution system for StumpfWorks NAS.

---

## ğŸ“ Repository Information

**Name**: `stumpfworks-nas-apps`
**URL**: https://github.com/Stumpf-works/stumpfworks-nas-apps
**Purpose**: Central plugin repository that StumpfWorks NAS instances query to discover, install, and update plugins
**Type**: Plugin distribution repository (similar to npm registry, pip index, Docker Hub)

---

## ğŸ—ï¸ Repository Structure

```
stumpfworks-nas-apps/
â”œâ”€â”€ README.md                    # Repository overview with stats
â”œâ”€â”€ CONTRIBUTING.md              # How to contribute plugins
â”œâ”€â”€ CLAUDE_CODE_MASTER_PROMPT.md # Full development context
â”œâ”€â”€ SESSION_PROMPT.md            # This file - start of session context
â”œâ”€â”€ registry.json                # AUTOGENERATED - Plugin index
â”‚
â”œâ”€â”€ .github/workflows/           # CI/CD automation
â”‚   â”œâ”€â”€ validate-plugins.yml     # Validates plugins on PR
â”‚   â””â”€â”€ update-registry.yml      # Auto-updates registry.json
â”‚
â”œâ”€â”€ scripts/                     # Automation scripts
â”‚   â”œâ”€â”€ generate-registry.py     # Generates registry.json from plugins/
â”‚   â””â”€â”€ validate-plugins.py      # Validates plugin.json files
â”‚
â”œâ”€â”€ templates/                   # Plugin starter templates
â”‚   â”œâ”€â”€ basic-plugin/
â”‚   â”œâ”€â”€ docker-plugin/
â”‚   â””â”€â”€ full-stack-plugin/
â”‚
â””â”€â”€ plugins/                     # ALL PLUGINS GO HERE
    â”œâ”€â”€ asterisk-voip/           # Example: VoIP plugin
    â”‚   â”œâ”€â”€ plugin.json          # Plugin manifest (REQUIRED)
    â”‚   â”œâ”€â”€ README.md            # Documentation (REQUIRED)
    â”‚   â”œâ”€â”€ CHANGELOG.md         # Version history (REQUIRED)
    â”‚   â”œâ”€â”€ LICENSE              # License (REQUIRED)
    â”‚   â”œâ”€â”€ releases/            # Release archives
    â”‚   â”‚   â””â”€â”€ v1.0.0.tar.gz
    â”‚   â””â”€â”€ [plugin files]
    â”‚
    â””â”€â”€ [other-plugins]/
```

---

## ğŸ¯ Your Role & Responsibilities

When working in this repository, you should:

### âœ… DO:
1. **Add/modify plugins** in `plugins/` directory
2. **Create plugin.json** with proper schema
3. **Write comprehensive README.md** for each plugin
4. **Follow semantic versioning** (1.0.0, 1.1.0, 2.0.0)
5. **Use provided templates** when creating new plugins
6. **Test plugins** before committing
7. **Update CHANGELOG.md** for each version
8. **Run validation scripts** before pushing
9. **Follow contribution guidelines** in CONTRIBUTING.md
10. **Reference CLAUDE_CODE_MASTER_PROMPT.md** for StumpfWorks NAS architecture

### âŒ DON'T:
1. **Manually edit registry.json** - It's autogenerated
2. **Commit binary files** unless they're releases
3. **Skip required files** (plugin.json, README.md, LICENSE)
4. **Use incorrect plugin ID format** (must be reverse domain: com.company.plugin)
5. **Ignore security best practices**
6. **Push directly to main** - Use PRs for new plugins

---

## ğŸ“‹ Plugin Requirements Checklist

Every plugin MUST have:

```
plugins/my-plugin/
â”œâ”€â”€ plugin.json          âœ… REQUIRED - Plugin manifest
â”œâ”€â”€ README.md            âœ… REQUIRED - User documentation
â”œâ”€â”€ CHANGELOG.md         âœ… REQUIRED - Version history
â”œâ”€â”€ LICENSE              âœ… REQUIRED - License file
â””â”€â”€ [plugin code]
```

### plugin.json Schema:

```json
{
  "id": "com.company.plugin-name",      // REQUIRED: Reverse domain notation
  "name": "Plugin Display Name",         // REQUIRED: Human readable
  "version": "1.0.0",                    // REQUIRED: Semantic versioning
  "author": "Your Name",                 // REQUIRED
  "description": "Brief description",    // REQUIRED: 50-200 chars
  "icon": "ğŸ”Œ",                          // REQUIRED: Emoji or path
  "category": "utilities",               // REQUIRED: See categories below

  "requires": {
    "docker": true/false,                // Does it need Docker?
    "ports": [8080, 8443],              // Required ports
    "storage": "1GB",                    // Minimum storage
    "minNasVersion": "0.1.0"            // Minimum NAS version
  },

  "config": {},                          // Default configuration
  "permissions": [],                     // Required permissions

  "links": {
    "homepage": "https://...",
    "issues": "https://...",
    "docs": "https://..."
  }
}
```

### Valid Categories:
- `storage` - Storage & backup solutions
- `media` - Media servers, streaming
- `communication` - VoIP, chat, email
- `development` - Git, CI/CD, databases
- `monitoring` - Metrics, logging, alerting
- `networking` - DNS, VPN, proxy
- `productivity` - Tasks, notes, documents
- `security` - Password managers, 2FA
- `utilities` - General tools

---

## ğŸ”„ Common Workflows

### 1ï¸âƒ£ Adding a New Plugin

```bash
# Step 1: Choose template
cp -r templates/docker-plugin plugins/my-plugin
cd plugins/my-plugin

# Step 2: Edit plugin.json
# - Set unique ID: com.github-username.plugin-name
# - Fill all required fields
# - Choose correct category

# Step 3: Develop plugin
# - Follow CLAUDE_CODE_MASTER_PROMPT.md
# - Test thoroughly
# - Write documentation

# Step 4: Create release archive
tar czf releases/v1.0.0.tar.gz \
  --exclude=".git" \
  --exclude="node_modules" \
  .

# Step 5: Validate
python3 ../../scripts/validate-plugins.py

# Step 6: Commit
git add .
git commit -m "Add: My Plugin v1.0.0"
git push

# Step 7: Create tag & GitHub release
git tag -a my-plugin-v1.0.0 -m "Release v1.0.0"
git push --tags

# Step 8: Registry updates automatically via GitHub Actions
```

### 2ï¸âƒ£ Updating an Existing Plugin

```bash
# Step 1: Navigate to plugin
cd plugins/existing-plugin

# Step 2: Make changes

# Step 3: Update version in plugin.json
# 1.0.0 â†’ 1.0.1 (bugfix)
# 1.0.0 â†’ 1.1.0 (new feature)
# 1.0.0 â†’ 2.0.0 (breaking change)

# Step 4: Update CHANGELOG.md
# Add new version entry

# Step 5: Create new release archive
tar czf releases/v1.1.0.tar.gz ...

# Step 6: Commit, tag, release
git add .
git commit -m "Update: Existing Plugin v1.1.0 - Brief description"
git tag existing-plugin-v1.1.0
git push --tags
```

### 3ï¸âƒ£ Testing a Plugin Locally

```bash
# Step 1: Copy to StumpfWorks NAS
sudo cp -r plugins/my-plugin /var/lib/stumpfworks/plugins/

# Step 2: Enable via API
curl -X POST http://localhost:8080/api/v1/plugins/my-plugin/enable \
  -H "Authorization: Bearer $TOKEN"

# Step 3: Check status
curl http://localhost:8080/api/v1/plugins/my-plugin/status \
  -H "Authorization: Bearer $TOKEN"

# Step 4: Check logs
journalctl -u stumpfworks-nas -f | grep my-plugin
```

### 4ï¸âƒ£ Validating Before Push

```bash
# From repository root
python3 scripts/validate-plugins.py

# Should output:
# âœ… plugin-name: Valid
# âœ… All plugins are valid!
```

---

## ğŸ¤– GitHub Actions (Automatic)

### On Pull Request / Push:
- `validate-plugins.yml` runs automatically
- Checks plugin.json syntax
- Verifies required files exist
- Validates docker-compose.yml (if present)
- Must pass before merge

### Daily + On Push to main:
- `update-registry.yml` runs automatically
- Scans all plugins/*/plugin.json
- Generates registry.json
- Commits if changed
- StumpfWorks NAS instances fetch this file

---

## ğŸ“¦ How StumpfWorks NAS Uses This Repository

```
1. User opens Plugin Store in StumpfWorks NAS UI
                â†“
2. NAS fetches: https://raw.githubusercontent.com/Stumpf-works/
                stumpfworks-nas-apps/main/registry.json
                â†“
3. User clicks "Install" on a plugin
                â†“
4. NAS downloads from: download_url in registry.json
                â†“
5. NAS extracts to: /var/lib/stumpfworks/plugins/
                â†“
6. Plugin is ready to enable and start
```

---

## ğŸ”— Important Files to Reference

1. **CLAUDE_CODE_MASTER_PROMPT.md**
   - Full StumpfWorks NAS architecture
   - Plugin development guide
   - Best practices & patterns
   - **Read this for plugin development context!**

2. **CONTRIBUTING.md**
   - Contribution guidelines
   - Review criteria
   - Submission process

3. **README.md**
   - Repository overview
   - User-facing information

---

## ğŸ¨ Example Session Scenarios

### Scenario 1: "I want to add a MinIO plugin"

**Response**:
1. Check if MinIO plugin already exists in `plugins/`
2. Copy template: `cp -r templates/docker-plugin plugins/minio`
3. Create plugin.json with:
   - id: com.stumpfworks.minio
   - category: storage
   - requires.docker: true
4. Create docker-compose.yml with MinIO container
5. Write README.md with setup instructions
6. Test locally
7. Create release archive
8. Commit and tag

### Scenario 2: "Update the Asterisk plugin to v1.1.0"

**Response**:
1. Navigate to `plugins/asterisk-voip/`
2. Make code changes
3. Update version in plugin.json: "1.1.0"
4. Add entry to CHANGELOG.md
5. Create new release archive
6. Commit: "Update: Asterisk VoIP v1.1.0 - Description"
7. Tag: `git tag asterisk-voip-v1.1.0`
8. Push with tags

### Scenario 3: "Validate all plugins"

**Response**:
```bash
python3 scripts/validate-plugins.py
```

---

## ğŸ” Security Guidelines

When reviewing/adding plugins:

### Check for:
- âŒ Hardcoded passwords/secrets
- âŒ Unnecessary privileged access
- âŒ Unvalidated user input
- âŒ Exposed sensitive ports
- âŒ Suspicious network activity
- âŒ Malicious code patterns

### Ensure:
- âœ… Environment variables for secrets
- âœ… Principle of least privilege
- âœ… Input validation
- âœ… TLS for external connections
- âœ… Security updates documented

---

## ğŸ“Š Plugin Categories & Examples

| Category | Examples | Description |
|----------|----------|-------------|
| storage | MinIO, Syncthing | Storage solutions |
| media | Plex, Jellyfin | Media servers |
| communication | Asterisk, Matrix | VoIP, chat, email |
| development | Gitea, Jenkins | Dev tools, CI/CD |
| monitoring | Prometheus, Grafana | Metrics, logs |
| networking | Pi-hole, WireGuard | DNS, VPN, proxy |
| productivity | Nextcloud, Bitwarden | Tasks, notes, passwords |
| security | Fail2Ban, ClamAV | Security tools |
| utilities | *various* | General utilities |

---

## ğŸš€ Quick Reference Commands

```bash
# Validate plugins
python3 scripts/validate-plugins.py

# Generate registry
python3 scripts/generate-registry.py

# Create release archive
tar czf releases/plugin-name-v1.0.0.tar.gz \
  --exclude=".git" --exclude="node_modules" \
  -C plugins/plugin-name .

# Tag release
git tag plugin-name-v1.0.0
git push --tags

# Check plugin structure
ls plugins/my-plugin/
# Should see: plugin.json README.md CHANGELOG.md LICENSE
```

---

## ğŸ’¡ Pro Tips

1. **Always reference CLAUDE_CODE_MASTER_PROMPT.md** when developing plugins for full architecture context

2. **Test locally first** before committing - use a real StumpfWorks NAS instance

3. **Use semantic versioning**:
   - 1.0.0 â†’ 1.0.1 = Bugfix (backward compatible)
   - 1.0.0 â†’ 1.1.0 = New feature (backward compatible)
   - 1.0.0 â†’ 2.0.0 = Breaking change

4. **Write good commit messages**:
   ```
   Add: Plugin Name v1.0.0 - Brief description
   Update: Plugin Name v1.1.0 - What changed
   Fix: Plugin Name v1.0.1 - What was fixed
   ```

5. **GitHub Actions will fail if**:
   - plugin.json has syntax errors
   - Required files are missing
   - docker-compose.yml is invalid

6. **Registry updates automatically** - Don't touch registry.json manually!

---

## â“ Common Questions

**Q: Where do I develop the actual plugin code?**
A: In `plugins/plugin-name/` - This repo contains the plugin AND distributes it.

**Q: How do I test integration with StumpfWorks NAS?**
A: Copy plugin to `/var/lib/stumpfworks/plugins/` on a running NAS instance, or reference CLAUDE_CODE_MASTER_PROMPT.md for the main NAS API.

**Q: What if I need StumpfWorks NAS system APIs?**
A: Read CLAUDE_CODE_MASTER_PROMPT.md section "System Library Architecture" - it explains all available APIs.

**Q: Can I have a separate Git repo for my plugin?**
A: Yes! You can develop elsewhere and copy to `plugins/` here for distribution. Just ensure all required files are present.

**Q: How do I update an already-released plugin?**
A: Bump version, update CHANGELOG, create new release archive, tag with new version.

---

## ğŸ¯ Session Start Checklist

When starting a new session, ask yourself:

- [ ] Do I understand what plugin I'm working on?
- [ ] Have I read the plugin's current README.md?
- [ ] Do I know which category it belongs to?
- [ ] Have I checked CLAUDE_CODE_MASTER_PROMPT.md for NAS architecture?
- [ ] Do I know the current version number?
- [ ] Have I identified what needs to be changed/added?

---

## ğŸ“š Key Files to Keep Open

1. `CLAUDE_CODE_MASTER_PROMPT.md` - Full development context
2. `plugins/[working-plugin]/plugin.json` - Current plugin manifest
3. `plugins/[working-plugin]/README.md` - Current documentation
4. `CONTRIBUTING.md` - Contribution guidelines

---

**You are now ready to work in the StumpfWorks NAS Apps Repository!**

For full plugin development context including StumpfWorks NAS architecture, APIs, and patterns, reference: `CLAUDE_CODE_MASTER_PROMPT.md`

ğŸš€ **Let's build amazing plugins!**
